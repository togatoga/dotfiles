# -----------------------------------------
# OS Detection
# -----------------------------------------
run-shell "tmux setenv -g TMUX_OS $(uname -s)"

# -----------------------------------------
# Common Settings
# -----------------------------------------
# set prefix C-q
set -g prefix C-q

# unbind prefix key
unbind C-b

# set emacs mode
set-window-option -g mode-keys emacs

# decrease key stroke
set -sg escape-time 1

# set history limit
set-option -g history-limit 20000

# ウィンドウのインデックスを1から始める
set -g base-index 1

# ペインのインデックスを1から始める
setw -g pane-base-index 1

set-option -g pane-active-border-style "bg=colour208"
set-option -ag pane-active-border-style "fg=black"

# パネルの背景色設定（アクティブ/非アクティブを区別）
set -g window-active-style 'bg=terminal' # アクティブなパネルは透明のまま
set -g window-style 'bg=colour238'       # 非アクティブなパネルを軽く暗く（内容も見える程度）

# status bar
set-option -g status on
set-option -g status-interval 1
set-option -g status-style bg=yellow
set -g status-right-length 100

# アクティブなウィンドウを目立たせる
setw -g window-status-current-style fg=white,bg=red,bright

# Synchronize
bind e set-window-option synchronize-panes on
bind E set-window-option synchronize-panes off # end

# open same directory
bind c new-window -c '#{pane_current_path}'
bind '"' split-window -c '#{pane_current_path}'
bind % split-window -h -c '#{pane_current_path}'

# | でペインを縦に分割する
bind | split-window -h -c '#{pane_current_path}'

# - でペインを横に分割する
bind - split-window -v -c '#{pane_current_path}'


# -----------------------------------------
# OS-specific Settings
# -----------------------------------------

# Linux (Ubuntu) specific
if-shell "[ $(uname -s) = 'Linux' ]" \
  "set-option -g default-shell /usr/bin/zsh; \
   bind-key -T copy-mode M-w send-keys -X copy-pipe-and-cancel 'xclip -i -sel clip > /dev/null'"

# macOS specific
if-shell "[ $(uname -s) = 'Darwin' ]" \
  "set -g default-command 'reattach-to-user-namespace -l ${SHELL}'; \
   bind-key -T copy-mode M-w send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'; \
   set -g @online_icon 'ok'; \
   set -g @offline_icon 'offline!'; \
   set -g status-right '#{battery_icon} #{battery_percentage} | Online: #{online_status} | #[fg=black][%Y-%m-%d(%a) %H:%M]'"

# -----------------------------------------
# tmux plugins
# To install `prefix+I`
# -----------------------------------------
set -g @tpm_plugins "               \
		tmux-plugins/tpm                \
		tmux-plugins/tmux-resurrect     \
		tmux-plugins/tmux-sidebar       \
		tmux-plugins/tmux-copycat       \
		tmux-plugins/tmux-open          \
		tmux-plugins/tmux-yank          \
		tmux-plugins/tmux-battery       \
		tmux-plugins/tmux-online-status \
		tmux-plugins/tmux-logging       \
		tmux-plugins/tmux-pain-control  \
		jimeh/tmux-themepack            \
		"

# Linux-specific theme
if-shell "[ $(uname -s) = 'Linux' ]" \
  "set -g @themepack 'powerline/block/yellow'"

# macOS-specific plugins (urlview)
set -g @plugin 'tmux-plugins/tmux-urlview'

# Initialize tpm
run-shell ~/.tmux/plugins/tpm/tpm
